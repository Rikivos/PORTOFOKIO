<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <title>Camera App</title>
</head>
<body>
    <!-- Video Display and Controls -->
    <div class="display-cover">
        <video autoplay></video>
        <canvas class="d-none"></canvas>

        <div class="video-options">
            <select class="custom-select">
                <option value="">Select camera</option>
            </select>
        </div>

        <div class="controls">
            <button class="btn btn-danger play" title="Play">
                <i data-feather="play-circle"></i>
            </button>
            <button class="btn btn-info pause d-none" title="Pause">
                <i data-feather="pause"></i>
            </button>
            <button class="btn btn-outline-success screenshot d-none" title="Screenshot">
                <i data-feather="image"></i>
            </button>
        </div>
    </div>

    <!-- Image Upload Form -->
    <form id="imageForm" class="mt-3">
        <div class="form-group">
            <label for="imageUpload">Uploaded Image:</label>
            <img 
                id="uploadedImage" 
                src="" 
                alt="Uploaded Image" 
                class="d-none img-thumbnail mt-2" 
                style="max-width: 400px;">
        </div>
    </form>

    <style>
        .screenshot-image {
            width: 150px;
            height: 90px;
            border-radius: 4px;
            border: 2px solid whitesmoke;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            position: absolute;
            bottom: 5px;
            left: 10px;
            background: white;
        }

        .display-cover {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 70%;
            margin: 5% auto;
            position: relative;
        }

        video {
            width: 100%;
            background: rgba(0, 0, 0, 0.2);
        }

        .video-options {
            position: absolute;
            left: 20px;
            top: 30px;
        }

        .controls {
            position: absolute;
            right: 20px;
            top: 20px;
            display: flex;
        }

        .controls > button {
            width: 45px;
            height: 45px;
            text-align: center;
            border-radius: 100%;
            margin: 0 6px;
            background: transparent;
        }

        @media (max-width: 400px) {
            .controls {
                flex-direction: column;
            }

            .controls button {
                margin: 5px 0;
            }
        }

        .controls button svg {
            height: 20px;
            width: 18px;
            color: inherit;
        }

        .controls button:nth-child(1) {
            border: 2px solid #D2002E;
            color: #D2002E;
        }

        .controls button:nth-child(2) {
            border: 2px solid #008496;
            color: #008496;
        }

        .controls button:nth-child(3) {
            border: 2px solid #00B541;
            color: #00B541;
        }
    </style>

    <script src="https://unpkg.com/feather-icons"></script>
    <script>
        feather.replace();

        const controls = document.querySelector('.controls');
        const cameraOptions = document.querySelector('.video-options > select');
        const video = document.querySelector('video');
        const canvas = document.querySelector('canvas');
        const [play, pause, screenshot] = [...controls.querySelectorAll('button')];
        let streamStarted = false;

        const constraints = {
            video: {
                width: { ideal: 1280 },
                height: { ideal: 720 },
            }
        };

        play.onclick = () => {
            if (streamStarted) {
                video.play();
                play.classList.add('d-none');
                pause.classList.remove('d-none');
            } else {
                navigator.mediaDevices.getUserMedia(constraints)
                    .then(startStream)
                    .catch(console.error);
            }
        };

        pause.onclick = () => {
            video.pause();
            play.classList.remove('d-none');
            pause.classList.add('d-none');
        };

        screenshot.onclick = () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            const imageURL = canvas.toDataURL('image/webp');
            const uploadedImage = document.getElementById('uploadedImage');
            uploadedImage.src = imageURL;
            uploadedImage.classList.remove('d-none');

            const link = document.createElement('a');
            link.href = imageURL;
            link.download = 'screenshot.webp';
            link.click();
        };

        const startStream = (stream) => {
            video.srcObject = stream;
            streamStarted = true;
            play.classList.add('d-none');
            pause.classList.remove('d-none');
            screenshot.classList.remove('d-none');
        };

        cameraOptions.onchange = async () => {
            const updatedConstraints = { ...constraints, deviceId: { exact: cameraOptions.value } };
            navigator.mediaDevices.getUserMedia(updatedConstraints)
                .then(startStream)
                .catch(console.error);
        };

        navigator.mediaDevices.enumerateDevices()
            .then((devices) => {
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                cameraOptions.innerHTML = videoDevices.map(device => `
                    <option value="${device.deviceId}">${device.label}</option>
                `).join('');
            })
            .catch(console.error);

        document.getElementById('openCameraButton').onclick = () => {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then((stream) => {
                    document.getElementById('videoElement').srcObject = stream;
                    document.getElementById('cameraContainer').style.display = 'block';
                    document.getElementById('closeButton').onclick = () => {
                        stream.getTracks().forEach(track => track.stop());
                        document.getElementById('cameraContainer').style.display = 'none';
                    };
                })
                .catch(() => alert('Could not access the camera.'));
        };
    </script>
</body>
</html>
